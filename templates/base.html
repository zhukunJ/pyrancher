<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="icon" href="/static/cssimage/img/dgrcevUROak.jpg">
    <title>{% block title %}{% endblock %}</title>
    <link rel="stylesheet" href="/static/layui/css/layui.css">
    <style>
        .namespace {
            margin-top: 10px;
        }

        .namespace select, .namespace option {
            width: 150px;
            height: 40px;
            font-size: 22px;
            color: #2F4056;
            overflow: auto;

        }
        .layui-table-cell {
            height: inherit;
        }

    </style>

</head>

<a href=""></a>
<body class="layui-layout-body">
{% block body_first %}{% endblock %}
<div class="layui-layout layui-layout-admin">
    <div class="layui-header layui-bg-cyan">
        <div class="layui-logo " style="font-weight: bold;font-size: 26px;color: orange"><i
                class="layui-icon layui-icon-chart-screen">&nbsp;&nbsp;</i><a style="color: orange"
                                                                              href="/">Pyrancher</a></div>
        <!-- 头部区域（可配合layui已有的水平导航） -->
        <ul class="layui-nav layui-layout-left">
            <div class="namespace">
                <select style="overflow: scroll;: darkslategray" name="namespace" id="nsSelect">
                </select>
            </div>
        </ul>
        <ul class="layui-nav layui-layout-right">
            <li class="layui-nav-item"><a href="/logout">注销</a></li>
        </ul>
    </div>
    <div></div>
    <div class="layui-side layui-bg-black  ">
        <div class="layui-side-scroll layui-bg-cyan ">
            <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
            <ul class="layui-nav layui-nav-tree layui-bg-cyan " lay-filter="test">
                 <li class="layui-nav-item"><a href="" >平台概述</a></li>

                <li class="layui-nav-item layui-nav-itemed">
                    <!-- layui-nav-itemed 使打开网页自动打开或者刷新监控系统的弹出折叠内容 -->
                    <!-- layui-this 选定之后左侧标题栏一直亮着-->
                    <a class="layui-anim layui-anim-scale" href="javascript:;"><i
                            class="layui-icon layui-icon-template-1 "
                            style="color: orange">&nbsp;&nbsp;</i>Kubernetes</a>
                    <dl class="layui-nav-child">
                        <dd><a class="{% block nav-this-1-1 %}{% endblock %}" href="{% url 'node' %}" style="color: #00FF00"> <i
                                class="layui-icon layui-icon-util" style="color: orange">&nbsp;&nbsp;</i> Nodes</a></dd>
                        <dd><a class="{% block nav-this-1-2 %}{% endblock %}" href="{% url 'namespace' %}"> <i
                                class="layui-icon layui-icon-chart-screen" style="color: orange">&nbsp;&nbsp;</i>Namespaces</a>
                        </dd>
                        <dd><a class="{% block nav-this-1-3 %}{% endblock %}" href="{% url 'pv' %}"> <i
                                class="layui-icon layui-icon-water" style="color: orange">&nbsp;&nbsp;</i>PersistentVolumes</a>
                        </dd>
                    </dl>
                </li>

                <li class="layui-nav-item layui-nav-itemed">
                    <a class="layui-anim layui-anim-scale" href="javascript:;"><i
                            class="layui-icon layui-icon-component" style="color: orange">&nbsp;&nbsp;</i>工作负载</a>
                    <dl class="layui-nav-child">
                        <dd><a class="{% block nav-this-2-1 %}{% endblock %}" href="{% url 'deployment' %}">Deployment</a></dd>
                        <dd><a class="{% block nav-this-2-2 %}{% endblock %}" href="{% url 'daemonset' %}">DaemonSets</a></dd>
                        <dd><a class="{% block nav-this-2-3 %}{% endblock %}" href="{% url 'statefulset' %}">StatefulSets</a></dd>
                        <dd><a class="{% block nav-this-2-4 %}{% endblock %}" href="{% url 'pod' %}">Pods</a></dd>
                    </dl>
                </li>

                <li class="layui-nav-item layui-nav-itemed">
                    <a class="layui-anim layui-anim-scale" href="javascript:;"><i
                            class="layui-icon layui-icon-component" style="color: orange">&nbsp;&nbsp;</i>负载均衡</a>
                    <dl class="layui-nav-child">
                        <dd><a href="{% url 'service' %}" class="{% block nav-this-3-1 %}{% endblock %}">Services</a></dd>
                        <dd><a href="{% url 'ingress' %}" class="{% block nav-this-3-2 %}{% endblock %}">Ingresses</a></dd>
                    </dl>
                </li>


                <li class="layui-nav-item layui-nav-itemed">
                    <a class="layui-anim layui-anim-scale" href="javascript:;"><i
                            class="layui-icon layui-icon-component" style="color: orange">&nbsp;&nbsp;</i>存储与配置</a>
                    <dl class="layui-nav-child">
                        <dd><a href="{% url 'pvc' %}" class="{% block nav-this-4-1 %}{% endblock %}">PersistentVolumeClaims</a></dd>
                        <dd><a href="{% url 'configmap' %}" class="{% block nav-this-4-2 %}{% endblock %}">ConfigMaps</a></dd>
                        <dd><a href="{% url 'secret' %}" class="{% block nav-this-4-3 %}{% endblock %}">Secrets</a></dd>
                    </dl>
                </li>

            </ul>
        </div>
    </div>


    <div class="layui-body" style="background-image: url(/static/cssimage/img/test.jpg);background-repeat: no-repeat;background-size: 100% 100%;background-attachment: fixed;animation: run 10s infinite linear;">
        {#        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp&nbsp;&nbsp;内容主体区域#}

        <div style="padding: 15px;">{% block content %}{% endblock %}</div>


        <div id="slideTest8" class="demo-slider"></div>

    </div>

    {#    <div class="layui-footer">#}
    {#        <!-- 底部固定区域 -->#}
    {#        © www.ctnrs.com#}
    {##}
    {#    </div>#}
    <script src="/static/layui/layui.js"></script>
    {% block js %}{% endblock %}
</div>


<script>
    //JavaScript代码区域
    layui.use('element', function () {
        var element = layui.element;
        var $ = layui.jquery;
        var layer = layui.layer;
        $.ajax({
            type: "GET",
            url: "{% url 'namespace_api' %}",
            timeout: 5000,  // 将当前选择的命名空间保存到本地浏览器session存储 ，因为ajax为异步所以设置async异步关闭，然后设置一个超时时间
            async: false, // 将当前选择的命名空间保存到本地浏览器session存储 ，因为ajax为异步所以设置async异步关闭
            success: function (res) {
                if (res.code == 0) {
                    for (let index in res.data) { //let 为定义一个局部变量index
                        row = res.data[index];
                        $("#nsSelect").append('<option value=' + row.name + '>' + row.name + '</option>')
                    }
                    // 设置默认命名空间
                    $("#nsSelect").val("default")
                } else {
                    $("#nsSelect").append('<option value="default">default</option>');
                    $("#nsSelect").attr("disabled", "disabled");
                    {#$("#nsSelect").append('<option value=' + res.msg + '>' + res.msg + '</option>')#}
                }
            },
            error: function () {
                layer.msg("服务器接口异常！", {icon: 5})
            }
        });
        // 将当前选择的命名空间保存到本地浏览器session存储，以便其他页面能获取到当前选择的命名空间 //章节：  Ajax动态渲染命名空间选项2
        var storage = window.sessionStorage;
        var namespace = storage.getItem("namespace");  //获取命名空间
        var current_ns = $("#nsSelect").val(); //获取当前默认值也就是default
        if (namespace == null) { //如果没有选择命名空间，我这里就选current_ns的默认命名空间default
            storage.setItem('namespace', current_ns)
        } else {
            $("#nsSelect").val(namespace)
        }

        $('#nsSelect').change(function () { //如果选择了命名空间就进行触发var storage = window.sessionStorage;以便其他页面能获取到当前选择的命名空间
            var current_ns = $("#nsSelect").val();
            storage.setItem('namespace', current_ns);
            location.reload() //重新加载新命名空间下的Kubernetes数据, //如果已经选择了命名空间，我就选择当前的名称 ,而且如果再次刷新页面还是我们选择的命名空间
        });


    });
</script>
</body>
</html>
